<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>F9 Productions - AI Chatbot</title>
    <!-- DHTMLX ChatBot CSS -->
    <link rel="stylesheet" href="https://cdn.dhtmlx.com/chatbot/latest/chatbot.css">
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            height: 100vh;
            background-color: #f5f5f5;
        }
        .container {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
        }
        .header {
            background-color: #333;
            color: white;
            padding: 15px;
            text-align: center;
        }
        .chat-container {
            flex: 1;
            padding: 20px;
        }
        #chatbot {
            width: 100%;
            height: 100%;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>F9 Productions AI Assistant</h1>
        </div>
        <div class="chat-container">
            <div id="chatbot"></div>
        </div>
    </div>

    <!-- DHTMLX ChatBot Script -->
    <script src="https://cdn.dhtmlx.com/chatbot/latest/chatbot.js"></script>
    <script>
        // Initialize the chatbot
        const bot = new chatbot.ChatBot("chatbot", {
            sidebar: false,
            format: "markdown",
            agents: [{
                id: 100,
                name: "F9 Architecture Assistant",
                avatar: "/f9-avatar.png" // You can add your company logo/avatar here
            }]
        });

        // Function to handle responses
        const response = content => bot.addMessage({ 
            message: { 
                role: "agent", 
                content, 
                typing: -1 
            }
        });

        // Add a welcome message
        bot.addMessage({
            message: {
                role: "agent",
                content: "Hello! I'm the F9 Productions Architecture Assistant. How can I help you today?",
                typing: 0
            }
        });

        // Handle user messages and OpenAI integration
        bot.on("add-message", ({ message }) => {
            if (message.role !== "user") return;
            
            // Start typing animation
            const typingMessage = {
                role: "agent",
                content: "",
                typing: 1
            };
            bot.addMessage({ message: typingMessage });
            
            // Prepare conversation history
            const prompt = [
                { role: "system", content: "You are an architectural assistant for F9 Productions, a premier architecture and design firm serving Colorado. You specialize in residential, multi-family, and commercial architecture. Be helpful, professional, and provide detailed information about architectural concepts, design processes, and F9 Productions services." },
            ];
            
            const messages = bot.getConfig().messages.map(x => {
                return {
                    role: x.role === "agent" ? "assistant" : "user",
                    content: x.content
                };
            });

            // Call your backend API that will handle the OpenAI request
            fetch("/api/chatbot", {
                method: "POST",
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    messages: prompt.concat(messages)
                })
            })
            .then(r => {
                if (r.status !== 200) {
                    throw new Error("Communication error with server");
                }
                return r.json();
            })
            .then(data => {
                // Remove typing message
                bot.typeMessage({ id: typingMessage.id, typing: 0 });
                
                // Add the response from OpenAI
                return response(data.content);
            })
            .catch(error => {
                // Remove typing message
                bot.typeMessage({ id: typingMessage.id, typing: 0 });
                
                // Show error message
                return response("Sorry, I encountered an error while processing your request. Please try again later.");
            });
        });
    </script>
</body>
</html> 